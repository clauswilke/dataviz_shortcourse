---
title: "From Data to Visualization 1"
author: "Claus O. Wilke"
date: "last updated: `r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: [default, "Wilke-slides-theme.css"]
    lib_dir: libs
    nature:
      ratio: '16:9'
      highlightStyle: github
      highlightLines: true
      slideNumberFormat: ''
      titleSlideClass: [center, middle]
params:
  cache: TRUE
---

```{r setup, include=FALSE, echo=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(comment = "")

library(tidyverse)
library(here)
library(cowplot)
library(colorspace)
library(ggforce)
library(ggridges)

# ggplot2 settings so plots scale well for slide size 
theme_set(theme_gray(16)) # 16 for full width, 18 for half width 
update_geom_defaults("point", list(size = 2)) # 2 for full width, 2.5 for half width

income_by_age <- readRDS(here("datasets", "income_by_age.rds"))

titanic <- read_csv(here("datasets", "titanic.csv")) %>%
  select(age, sex, class, survived) %>%
  arrange(age, sex, class)

lincoln_temps <- readRDS(here("datasets", "lincoln_temps.rds"))

blue_jays <- read_csv(here("datasets", "blue_jays.csv"))
hpi_trends <- read_csv(here("datasets", "hpi_trends.csv"))
```


## We often encounter datasets containing simple amounts

---

## We often encounter datasets containing simple amounts

Example: Highest grossing movies Dec. 2017

<br>

.center[
```{r echo = FALSE}
# Data from Box Office Mojo for Dec. 22-24, 2017. 
boxoffice <- tibble(
  rank = 1:5,
  title = c("Star Wars", "Jumanji", "Pitch Perfect 3", "Greatest Showman", "Ferdinand"),
  amount = c(71.57, 36.17, 19.93, 8.81, 7.32) # million USD
)

boxoffice %>%
  knitr::kable("html")
```
]

.tiny-font.absolute-bottom-right[
Data source: Box Office Mojo
]

---

## We can visualize amounts with bar plots

<br>

.center.move-up-1em[
```{r boxoffice-vertical, echo = FALSE, fig.width = 8.5, fig.asp = .5, dev = "svg"}
boxoffice %>%
  ggplot(aes(x = fct_reorder(title, rank), y = amount)) +
    geom_col(fill = "#56B4E9", width = 0.6, alpha = 0.9) +
    scale_y_continuous(
      expand = c(0, 0),
      breaks = c(0, 20, 40, 60),
      labels = c("0", "20", "40", "60"),
      name = "weekend gross (million USD)"
    ) +
    scale_x_discrete(
      name = NULL,
      expand = c(0, 0.4)
    ) +
    coord_cartesian(clip = "off") +
    theme_minimal_hgrid(12, rel_small = 1) +
    theme(
      axis.line.x = element_blank(),
      axis.ticks.x = element_blank()
    )
```
]

---

## Bars can also run horizontally

<br>

.center.move-up-1em[
```{r boxoffice-horizontal, echo = FALSE, fig.width = 7, fig.asp = .618, dev = "svg"}
ggplot(boxoffice, aes(x = fct_reorder(title, desc(rank)), y = amount)) +
  geom_col(fill = "#56B4E9", alpha = 0.9) +
  scale_y_continuous(
    limits = c(0, 75),
    expand = c(0, 0),
    breaks = c(0, 20, 40, 60),
    labels = c("0", "20", "40", "60"),
    name = "weekend gross (million USD)"
  ) +
  scale_x_discrete(
    name = NULL,
    expand = c(0, 0.5)
  ) +
  coord_flip(clip = "off") +
  theme_minimal_vgrid(rel_small = 1) +
  theme(
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank()
  )
```
]

---

## Pay attention to the order of the bars

<br>

.center.move-up-1em[
```{r boxoffice-horizontal-unordered, echo = FALSE, fig.width = 7, fig.asp = .618, dev = "svg"}
p_box_noorder <- ggplot(boxoffice) +
  aes(
    x = factor(title, levels = title[c(2, 1, 5, 3, 4)]),
    y = amount
  ) +
  geom_col(fill = "#56B4E9", alpha = 0.9) +
  scale_y_continuous(
    limits = c(0, 75),
    expand = c(0, 0),
    breaks = c(0, 20, 40, 60),
    labels = c("0", "20", "40", "60"),
    name = "weekend gross (million USD)"
  ) +
  scale_x_discrete(
    name = NULL,
    expand = c(0, 0.5)
  ) +
  coord_flip(clip = "off") +
  theme_minimal_vgrid(rel_small = 1) +
  theme(
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank()
  )

stamp_bad(p_box_noorder)
```
]

---

## Pay attention to the order of the bars

<br>

.center.move-up-1em[
![](`r knitr::fig_chunk("boxoffice-horizontal", "svg")`)
]

---

## We can use dots instead of bars

<br>

.center.move-up-1em[
```{r boxoffice-dotplot, echo = FALSE, fig.width = 7, fig.asp = .618, dev = "svg"}
ggplot(boxoffice, aes(x = fct_reorder(title, desc(rank)), y = amount)) +
  geom_point(color = "#0072B2", size = 4) +
  scale_y_continuous(
    limits = c(0, 75),
    expand = c(0, 0),
    breaks = c(0, 20, 40, 60),
    labels = c("0", "20", "40", "60"),
    name = "weekend gross (million USD)"
  ) +
  scale_x_discrete(
    name = NULL,
    expand = c(0, 0.5)
  ) +
  coord_flip(clip = "off") +
  theme_minimal_vgrid(rel_small = 1) +
  theme(
    axis.line.y = element_blank(),
    axis.ticks.y = element_blank()
  )
```
]

---

## Dots are preferable if we want to truncate the axes

.center.move-up-1em[
```{r Americas-life-expect, echo = FALSE, fig.width = 6., fig.asp = .9, dev = "svg"}
library(gapminder)

df_Americas <- gapminder %>% filter(year == 2007, continent == "Americas")

ggplot(df_Americas, aes(x = lifeExp, y = fct_reorder(country, lifeExp))) +
  geom_point(color = "#0072B2", size = 3) +
  scale_x_continuous(
    name = "life expectancy (years)",
    limits = c(59.7, 81.5),
    expand = c(0, 0)
  ) +
  scale_y_discrete(name = NULL, expand = c(0, 0.5)) +
  theme_minimal_grid(12, rel_small = 1) +
  theme(
    plot.margin = margin(18, 6, 3, 1.5)
  )
```
]

---

## Dots are preferable if we want to truncate the axes

.center.move-up-1em[
```{r Americas-life-expect-bad1, echo = FALSE, fig.width = 6., fig.asp = .9, dev = "svg"}
p <- ggplot(df_Americas, aes(x = lifeExp, y = fct_reorder(country, lifeExp))) +
  geom_col(fill = "#56B4E9", alpha = 0.9) +
  scale_x_continuous(
    name = "life expectancy (years)",
    expand = c(0, 0)
  ) +
  scale_y_discrete(name = NULL, expand = c(0, 0.5)) +
  coord_cartesian(xlim = c(59.7, 81.5)) +
  theme_minimal_grid(12, rel_small = 1) +
  theme(
    plot.margin = margin(18, 6, 3, 1.5)
  )

stamp_bad(p)
```
]

.absolute-bottom-right[
bar lengths do<br>not accurately<br>represent the<br>data values
]

---

## Dots are preferable if we want to truncate the axes

.center.move-up-1em[
```{r Americas-life-expect-bad2, echo = FALSE, fig.width = 6., fig.asp = .9, dev = "svg"}
p <- ggplot(df_Americas, aes(x = lifeExp, y = fct_reorder(country, lifeExp))) +
  geom_col(fill = "#56B4E9", alpha = 0.9) +
  scale_x_continuous(
    name = "life expectancy (years)",
    expand = c(0, 0)
  ) +
  scale_y_discrete(name = NULL, expand = c(0, 0.5)) +
  coord_cartesian(xlim = c(0, 85)) +
  theme_minimal_grid(12, rel_small = 1) +
  theme(
    plot.margin = margin(18, 6, 3, 1.5)
  )

stamp_bad(p)
```
]

.absolute-bottom-right[
key features<br>of the data<br>are obscured
]


---

## Dots are preferable if we want to truncate the axes

.center.move-up-1em[
![](`r knitr::fig_chunk("Americas-life-expect", "svg")`)
]

---

## We use grouped bars for higher-dimensional datasets

--

<br>

.center.move-up-1em[
```{r income-by-age-race-dodged, echo = FALSE, fig.width = 9, fig.asp = 0.5, dev = "svg"}
# Take the darkest four colors from 5-class ColorBrewer palette "PuBu"
# colors_four <- RColorBrewer::brewer.pal(5, "PuBu")[5:2]
colors_four <- c("#045A8D", "#2B8CBE", "#74A9CF", "#BDC9E1")

ggplot(income_by_age, aes(x = age, y = median_income, fill = race)) +
  geom_col(position = "dodge", alpha = 0.9) +
  scale_y_continuous(
    expand = c(0, 0),
    name = "median income (USD)",
    breaks = c(0, 20000, 40000, 60000, 80000, 100000),
    labels = c("$0", "$20,000", "$40,000", "$60,000", "$80,000", "$100,000")
  ) +
  scale_fill_manual(values = colors_four, name = NULL) +
  coord_cartesian(clip = "off") +
  xlab("age (years)") +
  theme_minimal_hgrid() +
  theme(
    axis.line.x = element_blank(),
    axis.ticks.x = element_blank()
  )
```
]

.absolute-bottom-right[
Data source: United States Census Bureau, 2016
]

---

## We are free to choose by which variable to group

<br>

.center[
```{r income-by-race-age-dodged, echo = FALSE, fig.width = 8, fig.asp = 0.4, dev = "svg"}
# Take the darkest seven colors from 8-class ColorBrewer palette "PuBu"
# colors_seven <- RColorBrewer::brewer.pal(8, "PuBu")[2:8]
colors_seven <- c("#ECE7F2", "#D0D1E6", "#A6BDDB", "#74A9CF", "#3690C0", "#0570B0", "#034E7B")

ggplot(income_by_age, aes(x = race, y = median_income, fill = age)) +
  geom_col(position = "dodge", alpha = 0.9) +
  scale_y_continuous(
    expand = c(0, 0),
    name = "median income (USD)",
    breaks = c(0, 20000, 40000, 60000, 80000, 100000),
    labels = c("$0", "$20,000", "$40,000", "$60,000", "$80,000", "$100,000")
  ) +
  scale_fill_manual(values = colors_seven, name = "age (yrs)") +
  coord_cartesian(clip = "off") +
  xlab(label = NULL) +
  theme_minimal_hgrid() +
  theme(
    axis.line.x = element_blank(),
    axis.ticks.x = element_blank(),
    legend.title.align = 0.5
  )
```
]

.absolute-bottom-right[
Data source: United States Census Bureau, 2016
]

---

## We can also use multiple plot panels (facets)

.center[
```{r income-by-age-race-faceted, echo = FALSE, fig.width = 8, fig.asp = 0.618, dev = "svg"}
ggplot(income_by_age, aes(x = age_brief, y = median_income)) +
  geom_col(fill = "#56B4E9", alpha = 0.9) +
  scale_y_continuous(
    expand = c(0, 0),
    name = "median income (USD)",
    breaks = c(0, 20000, 40000, 60000, 80000, 100000),
    labels = c("$0", "$20,000", "$40,000", "$60,000", "$80,000", "$100,000")
  ) +
  coord_cartesian(clip = "off") +
  xlab(label = "age (years)") +
  facet_wrap(~race, scales = "free_x") +
  theme_minimal_hgrid(12) +
  theme(
    axis.ticks.x = element_blank(),
    axis.line = element_blank(),
    strip.text = element_text(size = 12),
    panel.spacing.y = grid::unit(14, "pt")
  )
```
]

.absolute-bottom-right[
Data source: United States Census Bureau, 2016
]

---


class: center middle

## Histograms and density plots

---

## Passengers on the Titanic

.center.small-font[
```{r echo = FALSE}
knitr::kable(titanic[1:10,], "html")
```
&nbsp;&nbsp;&nbsp;&nbsp;
```{r echo = FALSE}
knitr::kable(titanic[11:20,], "html")
```
&nbsp;&nbsp;&nbsp;&nbsp;
```{r echo = FALSE}
knitr::kable(titanic[21:30,], "html")
```
]

---

## Histogram: Define bins and count cases

```{r echo = FALSE}
age_counts <- hist(titanic$age, breaks = (0:15) * 5 + .01, plot = FALSE)$counts
age_hist <- tibble(
  `age range` = c("0–5", "6–10", "11–15", "16–20", "21–25", "26–30", "31–35", "36–40", "41–45", "46–50", "51–55", "56–60", "61–65", "66–70", "71–75", "76–80"),
  count = c(age_counts, 0)
)
```

.pull-left.small-font[
```{r echo = FALSE}
knitr::kable(age_hist[1:8,], "html")
```
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
```{r echo = FALSE}
knitr::kable(age_hist[9:16,], "html")
```
]

--

.pull-right[
```{r titanic-age-hist, echo = FALSE, fig.width = 5.5, fig.asp = 0.618, dev = "svg"}
age_hist5 <- age_hist %>%
  mutate(age = (1:16) * 5 - 2.5) %>%
  filter(count > 0)

h1 <- ggplot(age_hist5, aes(x = age, y = count)) + 
  geom_col(width = 4.7, fill = "#56B4E9", na.rm = TRUE)  + 
  scale_y_continuous(expand = c(0, 0), breaks = 25 * (0:5)) +
  scale_x_continuous(name = "age (years)", limits = c(0, 75), expand = c(0, 0)) +
  coord_cartesian(clip = "off") +
  theme_minimal_hgrid(18) +
  theme(
    axis.line.x = element_blank()
  )

h1
```
]

???

Figure redrawn from [Claus O. Wilke. Fundamentals of Data Visualization. O'Reilly, 2019.](https://clauswilke.com/dataviz)


---

# Histograms depend on the chosen bin width

.center[
```{r titanic-age-hist-binwidth, echo = FALSE, fig.width = 8, fig.asp = 0.618, dev = "svg"}
age_hist_1 <- tibble(
  age = (1:75) - 0.5, 
  count = hist(titanic$age, breaks = (0:75) + .01, plot = FALSE)$counts
)
age_hist_3 <- tibble(
  age = (1:25) * 3 - 1.5, 
  count = hist(titanic$age, breaks = (0:25) * 3 + .01, plot = FALSE)$counts
)
age_hist_15 <- tibble(
  age = (1:5) * 15 - 7.5, 
  count = hist(titanic$age, breaks = (0:5) * 15 + .01, plot = FALSE)$counts
)


h2 <- ggplot(age_hist_1, aes(x = age, y = count)) + 
  geom_col(width = .85, fill = "#56B4E9")  + 
  scale_y_continuous(expand = c(0, 0), breaks = 10 * (0:5)) +
  scale_x_continuous(name = "age (years)", limits = c(0, 75), expand = c(0, 0)) +
  coord_cartesian(clip = "off") +
  theme_minimal_hgrid(14) +
  theme(
    axis.line.x = element_blank()
  )

h3 <- ggplot(age_hist_3, aes(x = age, y = count)) + 
  geom_col(width = 2.75, fill = "#56B4E9")  + 
  scale_y_continuous(expand = c(0, 0), breaks = 25 * (0:5)) +
  scale_x_continuous(name = "age (years)", limits = c(0, 75), expand = c(0, 0)) +
  coord_cartesian(clip = "off") +
  theme_minimal_hgrid(14) +
  theme(
    axis.line.x = element_blank()
  )

h4 <- ggplot(age_hist_15, aes(x = age, y = count)) + 
  geom_col(width = 14.5, fill = "#56B4E9")  + 
  scale_y_continuous(expand = c(0, 0), breaks = 100 * (0:4)) +
  scale_x_continuous(name = "age (years)", limits = c(0, 75), expand = c(0, 0)) +
  coord_cartesian(clip = "off") +
  theme_minimal_hgrid(14) +
  theme(
    axis.line.x = element_blank()
  )

h1 <- h1 + theme_minimal_hgrid(16) +
  theme(
    axis.line.x = element_blank()
  )

plot_grid(
  h2, NULL, h3,
  NULL, NULL, NULL,
  h1, NULL, h4,
  align = 'hv',
  rel_widths = c(1, .04, 1),
  rel_heights = c(1, .04, 1)
)
```
]

???

Figure redrawn from [Claus O. Wilke. Fundamentals of Data Visualization. O'Reilly, 2019.](https://clauswilke.com/dataviz)


---


## Alternative to histogram: Kernel density estimate (KDE)

.pull-left[
```{r titanic-age-hist2, echo = FALSE, fig.width = 7, fig.asp = 0.618, dev = "svg"}
h1 + ggtitle("Histogram") + theme(plot.title.position = "plot")
```
]

--

.pull-right[
```{r titanic-age-kde, echo = FALSE, fig.width = 7, fig.asp = 0.618, dev = "svg"}
ggplot(titanic, aes(x = age)) + 
  geom_density(fill = "#56B4E9", color = darken("#56B4E9", 0.5), bw = 2, kernel = "gaussian") + 
  scale_y_continuous(limits = c(0, 0.046), expand = c(0, 0), name = "density") +
  scale_x_continuous(name = "age (years)", limits = c(0, 75), expand = c(0, 0)) +
  coord_cartesian(clip = "off") +
  ggtitle("Kernel density estimate") +
  theme_minimal_hgrid(18) +
  theme(
    axis.line.x = element_blank(),
    plot.title.position = "plot"
  )
```
]

--

Histograms show raw counts, KDEs show proportions. (Total area = 1)

???

Figures redrawn from [Claus O. Wilke. Fundamentals of Data Visualization. O'Reilly, 2019.](https://clauswilke.com/dataviz)

---


## KDEs also depend on parameter settings

.center[
```{r titanic-age-kde-grid, echo = FALSE, fig.width = 8, fig.asp = 0.618, dev = "svg"}
pdens1 <- ggplot(titanic, aes(x = age)) + 
  geom_density(fill = "#56B4E9", color = darken("#56B4E9", 0.5), bw = .5, kernel = "gaussian") + 
  scale_y_continuous(limits = c(0, 0.046), expand = c(0, 0), name = "density") +
  scale_x_continuous(name = "age (years)", limits = c(0, 75), expand = c(0, 0)) +
  coord_cartesian(clip = "off") +
  theme_minimal_hgrid(14) +
  theme(axis.line.x = element_blank())

pdens2 <- ggplot(titanic, aes(x = age)) + 
  geom_density(fill = "#56B4E9", color = darken("#56B4E9", 0.5), bw = 2, kernel = "gaussian") + 
  scale_y_continuous(limits = c(0, 0.046), expand = c(0, 0), name = "density") +
  scale_x_continuous(name = "age (years)", limits = c(0, 75), expand = c(0, 0)) +
  coord_cartesian(clip = "off") +
  theme_minimal_hgrid(14) +
  theme(axis.line.x = element_blank())

pdens3 <- ggplot(titanic, aes(x = age)) + 
  geom_density(fill = "#56B4E9", color = darken("#56B4E9", 0.5), bw = 5, kernel = "gaussian") + 
  scale_y_continuous(limits = c(0, 0.046), expand = c(0, 0), name = "density") +
  scale_x_continuous(name = "age (years)", limits = c(0, 75), expand = c(0, 0)) +
  coord_cartesian(clip = "off") +
  theme_minimal_hgrid(14) +
  theme(axis.line.x = element_blank())

pdens4 <- ggplot(titanic, aes(x = age)) + 
  geom_density(fill = "#56B4E9", color = darken("#56B4E9", 0.5), bw = 2, kernel = "rectangular") + 
  scale_y_continuous(limits = c(0, 0.046), expand = c(0, 0), name = "density") +
  scale_x_continuous(name = "age (years)", limits = c(0, 75), expand = c(0, 0)) +
  coord_cartesian(clip = "off") +
  theme_minimal_hgrid(14) +
  theme(axis.line.x = element_blank())

plot_grid(
  pdens1, NULL, pdens2, 
  NULL, NULL, NULL,
  pdens3, NULL, pdens4,
  align = 'hv',
  rel_widths = c(1, .04, 1),
  rel_heights = c(1, .04, 1)
)
```
]


???

Figure redrawn from [Claus O. Wilke. Fundamentals of Data Visualization. O'Reilly, 2019.](https://clauswilke.com/dataviz)


---


## Careful: Are bars stacked or overlapping?

.pull-left[
```{r titanic-age-hist-stacked, echo = FALSE, fig.width = 7, fig.asp = 0.618, dev = "svg"}
gender_counts <- tibble(
  age = (1:25)*3 - 1.5, 
  male = hist(filter(titanic, sex == "male")$age, breaks = (0:25)*3 + .01, plot = FALSE)$counts,
  female = hist(filter(titanic, sex == "female")$age, breaks = (0:25)*3 + .01, plot = FALSE)$counts
) %>%
  pivot_longer(-age, names_to = "gender", values_to = "count")

gender_counts$gender <- factor(gender_counts$gender, levels = c("female", "male"))

ggplot(gender_counts, aes(x = age, y = count, fill = gender)) + 
  geom_col(position = "stack") +
  scale_x_continuous(name = "age (years)", limits = c(0, 75), expand = c(0, 0)) +
  scale_y_continuous(limits = c(0, 89), expand = c(0, 0), name = "count") +
  scale_fill_manual(values = c("#D55E00", "#0072B2")) +
  coord_cartesian(clip = "off") +
  theme_minimal_hgrid(18) +
  theme(
    axis.line.x = element_blank(),
    legend.position = c(.9, .87),
    legend.justification = c("right", "top"),
    legend.box.background = element_rect(fill = "white", color = "white")
  )
```
]

--

.pull-right[
```{r titanic-age-hist-overlap, echo = FALSE, fig.width = 7, fig.asp = 0.618, dev = "svg"}
ggplot(gender_counts, aes(x = age, y = count, fill = gender)) + 
  geom_col(position = "identity", alpha = 0.7) +
  scale_x_continuous(name = "age (years)", limits = c(0, 75), expand = c(0, 0)) +
  scale_y_continuous(limits = c(0, 56), expand = c(0, 0), name = "count") +
  scale_fill_manual(
    values = c("#D55E00", "#0072B2"),
    guide = guide_legend(reverse = TRUE)
  ) +
  coord_cartesian(clip = "off") +
  theme_minimal_hgrid(18) +
  theme(
    axis.line.x = element_blank(),
    legend.position = c(.9, .87),
    legend.justification = c("right", "top"),
    legend.box.background = element_rect(fill = "white", color = "white")
  )
```
]

--

Stacked or overlapping histograms are rarely a good choice.

???

Figures redrawn from [Claus O. Wilke. Fundamentals of Data Visualization. O'Reilly, 2019.](https://clauswilke.com/dataviz)

---

## Alternatively: Age pyramid

.center[
```{r titanic-age-pyramid, echo = FALSE, fig.width = 7, fig.asp = 0.618, dev = "svg"}
ggplot(gender_counts, aes(x = age, y = ifelse(gender == "male", -1, 1)*count, fill = gender)) + 
  geom_col() +
  scale_x_continuous(name = "age (years)", limits = c(0, 75), expand = c(0, 0)) +
  scale_y_continuous(name = "count", breaks = 20*(-2:1), labels = c("40", "20", "0", "20")) +
  scale_fill_manual(values = c("#D55E00", "#0072B2"), guide = "none") +
  draw_text(x = 70, y = -39, "male", hjust = 0) +
  draw_text(x = 70, y = 21, "female", hjust = 0) +
  coord_flip() +
  theme_minimal_grid(16) +
  theme(axis.title.x = element_text(hjust = 0.61))
```
]

???

Figures redrawn from [Claus O. Wilke. Fundamentals of Data Visualization. O'Reilly, 2019.](https://clauswilke.com/dataviz)

---

## What if we want to show more than two distributions?

.pull-left.small-font[
Mean temperatures in Lincoln, NE, in January 2016:

.center[
```{r temps_table, echo = FALSE}
lincoln_temps %>%
  filter(month == "Jan") %>%
  select(date, `mean temp` = mean_temp) %>%
  knitr::kable()
```
]]

--

.pull-right[
```{r temps_densities_january, echo = FALSE, fig.width = 5.5, fig.asp = 0.618, dev = "svg"}
lincoln_temps %>%
  filter(month == "Jan") %>%
  ggplot(aes(mean_temp)) +
  geom_density(fill = "#56B4E9", alpha = 0.7) +
  scale_x_continuous(
    name = "mean temperature (°F)",
    expand = c(0, 0)
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.06))) +
  ggtitle("Temperature distribution") +
  theme_minimal_grid(18) +
  theme(
    plot.title.position = "plot",
    plot.title = element_text(face = "plain")
  )
```
]

---


## What if we want to show more than two distributions?

.pull-left.small-font[
Mean temperatures in Lincoln, NE, in January 2016:

.center[
```{r temps_table2, ref.label = "temps_table", echo = FALSE}
```
]]

.pull-right[
```{r temps_densities_january2, ref.label = "temps_densities_january", echo = FALSE, fig.width = 5.5, fig.asp = 0.618, dev = "svg"}
```

How can we compare distributions across months?
]


---

## A bad idea: Many overlapping density plots

.center[
```{r temps_densities_overlapping, echo = FALSE, fig.width = 8, fig.asp = 0.618, dev = "svg"}
p <- lincoln_temps %>%
  mutate(
    month_long = fct_rev(month_long)
  ) %>%
  ggplot(aes(mean_temp, fill = month)) +
  geom_density(alpha = 0.5) +
  scale_x_continuous(
    name = "mean temperature (°F)",
    expand = c(0, 0)
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.06))) +
  scale_fill_viridis_d(option = "D") +
  labs(subtitle = "") + # empty subtitle for some vertical space
  theme_minimal_grid(16)

stamp_bad(p)
```
]

---

## Another bad idea: Stacked density plots

.center[
```{r temps_densities_stacked, echo = FALSE, fig.width = 8, fig.asp = 0.618, dev = "svg"}
p <- lincoln_temps %>%
  mutate(
    month_long = fct_rev(month_long)
  ) %>%
  ggplot(aes(mean_temp, fill = month)) +
  geom_density(alpha = 0.7, position = "stack") +
  scale_x_continuous(
    name = "mean temperature (°F)",
    expand = c(0, 0)
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.06))) +
  scale_fill_viridis_d(option = "D") +
  labs(subtitle = "") + # empty subtitle for some vertical space
  theme_minimal_grid(16)

stamp_bad(p)
```
]

---

## Somewhat better: Small multiples

.center[
```{r temps_densities, echo = FALSE, fig.width = 8, fig.asp = 0.618, dev = "svg"}
lincoln_temps %>%
  mutate(
    month_long = fct_rev(month_long)
  ) %>%
  ggplot(aes(mean_temp)) +
  geom_density(fill = "#56B4E9") +
  scale_x_continuous(
    name = "mean temperature (°F)",
    expand = c(0, 0)
  ) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.06))) +
  facet_wrap(vars(month_long)) +
  theme_minimal_grid(16, color = "gray65") +
  theme(
    panel.background = element_rect(fill = "gray95")
  )
```
]

---

## Instead: Show values along y, conditions along x
   
.center[
```{r temps_boxplots, echo = FALSE, fig.width = 6, fig.asp = 0.618, dev = "svg"}
ggplot(lincoln_temps, aes(x = month, y = mean_temp)) +
  geom_boxplot(fill = "gray90") + 
  xlab("month") + 
  ylab("mean temperature (°F)") +
  theme_half_open()
```
]

???

Figure redrawn from [Claus O. Wilke. Fundamentals of Data Visualization. O'Reilly, 2019.](https://clauswilke.com/dataviz)

--

A boxplot is a crude way of visualizing a distribution.

---

## How to read a boxplot

.center[
```{r boxplot-schematic, echo = FALSE, fig.width = 8, fig.asp = 0.618, dev = "svg"}
set.seed(3423)

y <- c(rnorm(100), 3.4)
s <- boxplot.stats(y)
df <- tibble(
  y = c(s$stats, max(y)),
  x = c(1.03, 1.405, 1.405, 1.405, 1.03, 1.04),
  label = c("minimum", "first quartile", "median", "third quartile", "maximum within upper fence", "outlier")
)

p_points <- ggplot(tibble(y), aes(x = 0, y = y)) + 
  geom_point(position = position_jitter(width = .4, height = 0, seed = 320)) +
  annotate("text", label = "data", x = 0, y = 4, hjust = 0.5, vjust = 1, size = 20/.pt) +
  scale_x_continuous(limits = c(-1.8, .4), expand = c(0, 0)) +
  scale_y_continuous(limits = c(-2.55, 4), expand = c(0, 0)) +
  coord_cartesian(clip = "off") +
  theme_nothing()

p_boxplot <- ggplot(tibble(y), aes(x = 1, y = y)) + 
  geom_boxplot(fill = "gray90", outlier.size = 2) +
  annotate("text", label = "boxplot", x = 1, y = 4, hjust = 0.5, vjust = 1, size = 20/.pt) +
  geom_text(
    data = df, aes(x, y, label = label), hjust = 0,
    size = 16/.pt
  ) +
  scale_x_continuous(limits = c(0, 3.5), expand = c(0, 0)) +
  scale_y_continuous(limits = c(-2.55, 4), expand = c(0, 0)) +
  coord_cartesian(clip = "off") +
  theme_nothing()

plot_grid(p_points, p_boxplot, rel_widths = c(.65, 1), nrow = 1)
```
]


???

Figure redrawn from [Claus O. Wilke. Fundamentals of Data Visualization. O'Reilly, 2019.](https://clauswilke.com/dataviz)

---

## If you like density plots, consider violins
   
.center[
```{r temps_violins, echo = FALSE, fig.width = 6, fig.asp = 0.618, dev = "svg"}
ggplot(lincoln_temps, aes(x = month, y = mean_temp)) +
  geom_violin(fill = "gray90") + 
  xlab("month") + 
  ylab("mean temperature (°F)") +
  theme_half_open()
```
]

???

Figure redrawn from [Claus O. Wilke. Fundamentals of Data Visualization. O'Reilly, 2019.](https://clauswilke.com/dataviz)

--

A violin plot is a density plot rotated 90 degrees and then mirrored.

---

## How to read a violin plot

.center[
```{r violin-schematic, echo = FALSE, fig.width = 8, fig.asp = 0.618, dev = "svg"}
set.seed(3423)

y <- c(rnorm(100), 3.4)
d <- density(y)
df <- tibble(
  y = c(min(y), d$x[which(d$y == max(d$y))], max(y)),
  x = c(1.1, 1.5, 1.08),
  label = c("minimum data value", "maximum point density", "maximum data value")
)

p_points <- ggplot(tibble(y), aes(x = 0, y = y)) + 
  geom_point(position = position_jitter(width = .4, height = 0, seed = 320)) +
  annotate("text", label = "data", x = 0, y = 4, hjust = 0.5, vjust = 1, size = 20/.pt) +
  scale_x_continuous(limits = c(-1.8, .4), expand = c(0, 0)) +
  scale_y_continuous(limits = c(-2.55, 4), expand = c(0, 0)) +
  coord_cartesian(clip = "off") +
  theme_nothing()

p_violin <- ggplot(tibble(y), aes(x = 1, y = y)) + 
  geom_violin(fill = "gray90") +
  annotate("text", label = "violin plot", x = 1, y = 4, hjust = 0.5, vjust = 1, size = 20/.pt) +
  geom_text(
    data = df, aes(x, y, label = label), hjust = 0,
    size = 16/.pt
  ) +
  scale_x_continuous(limits = c(0, 3.5), expand = c(0, 0)) +
  scale_y_continuous(limits = c(-2.55, 4), expand = c(0, 0)) +
  coord_cartesian(clip = "off") +
  theme_nothing()

plot_grid(p_points, p_violin, rel_widths = c(.65, 1), nrow = 1)
```
]

???

Figure redrawn from [Claus O. Wilke. Fundamentals of Data Visualization. O'Reilly, 2019.](https://clauswilke.com/dataviz)

---

## For small datasets, you can also use a strip chart

Advantage: Can see raw data points instead of abstract representation.

.center[
```{r temps_stripchart, echo = FALSE, fig.width = 6, fig.asp = 0.618, dev = "svg"}
ggplot(lincoln_temps, aes(x = month, y = mean_temp)) +
  geom_point(
    position = position_jitter(width = .15, height = 0, seed = 320),
    size = 0.75
  ) +
  xlab("month") + 
  ylab("mean temperature (°F)") +
  theme_half_open()
```
]

???

Figure redrawn from [Claus O. Wilke. Fundamentals of Data Visualization. O'Reilly, 2019.](https://clauswilke.com/dataviz)

--

Horizontal jittering may be necessary to avoid overlapping points.

---

## For small datasets, you can also use a strip chart

Advantage: Can see raw data points instead of abstract representation.

.center[
```{r temps_stripchart2, echo = FALSE, fig.width = 6, fig.asp = 0.618, dev = "svg"}
ggplot(lincoln_temps, aes(x = month, y = mean_temp)) +
  geom_point(size = 0.75) +
  xlab("month") + 
  ylab("mean temperature (°F)") +
  theme_half_open()
```
]

Horizontal jittering may be necessary to avoid overlapping points.

???

Figure redrawn from [Claus O. Wilke. Fundamentals of Data Visualization. O'Reilly, 2019.](https://clauswilke.com/dataviz)

---

## For small datasets, you can also use a strip chart

Advantage: Can see raw data points instead of abstract representation.

.center[
```{r temps_stripchart3, ref.label = "temps_stripchart", echo = FALSE, fig.width = 6, fig.asp = 0.618, dev = "svg"}
```
]

Horizontal jittering may be necessary to avoid overlapping points.


???

Figure redrawn from [Claus O. Wilke. Fundamentals of Data Visualization. O'Reilly, 2019.](https://clauswilke.com/dataviz)

---

## And the final option, a ridgeline plot

.center[
```{r lincoln-ridgeline-polished, echo = FALSE, fig.width = 6, fig.asp = 0.618, dev = "svg"}

ggplot(lincoln_temps, aes(x = mean_temp, y = month_long)) +
  geom_density_ridges(
    scale = 3,
    rel_min_height = 0.01,
    bandwidth = 3.4,
    fill = lighten("#56B4E9", .3),
    color = "white"
  ) +
  scale_x_continuous(
    name = "mean temperature (°F)",
    expand = c(0, 0)#, breaks = c(0, 25, 50, 75)
  ) +
  scale_y_discrete(name = NULL, expand = expansion(add = c(0.2, 2.6))) +
  theme_minimal_grid(16) +
  theme(
    axis.text.y = element_text(vjust = 0)
  )
```
]


???

Figure redrawn from [Claus O. Wilke. Fundamentals of Data Visualization. O'Reilly, 2019.](https://clauswilke.com/dataviz)

--

Notice the single fill color. More colors would be distracting. 

---


## We visualize associations with scatter plots

.center[
```{r blue-jays-scatter, echo = FALSE, message = FALSE, fig.width = 6, fig.asp = 3.2/4, dev = "svg"}
blue_jays %>%
  ggplot(aes(body_mass_g, head_length_mm)) + 
  geom_point(aes(fill = "blue jay birds"), pch = 21, color = "white", size = 2.5) +
  scale_fill_manual(
    values = c(`blue jay birds` = "black", `regression line` = "black"),
    limits = c("blue jay birds"),
    name = NULL,
    guide = guide_legend(
      direction = "horizontal",
      override.aes = list(
        size = 2.5,
        linetype = 0
      )
    )
  ) +
  scale_color_manual(
    values = c(`blue jay birds` = "black", `regression line` = "black"),
    limits = c("blue jay birds"),
    name = NULL
  ) +
  scale_x_continuous(name = "body mass (g)", limits = c(58.7, 81.6)) +
  scale_y_continuous(name = "head length (mm)", limits = c(51.5, 60.8)) +
  theme_minimal_grid() +
  theme(
    legend.position = "top",
    legend.justification = "right",
    legend.box.spacing = unit(3.5, "pt"), # distance between legend and plot
    legend.text = element_text(vjust = 0.6),
    legend.spacing.x = unit(2, "pt"),
    legend.background = element_rect(fill = "white", color = NA),
    legend.key.width = unit(10, "pt")
  )
```
]

???

Figure redrawn after [Claus O. Wilke. Fundamentals of Data Visualization. O'Reilly, 2019.](https://clauswilke.com/dataviz)

---

## We visualize associations with scatter plots

.center[
```{r blue-jays-scatter-line-sex, echo = FALSE, message = FALSE, fig.width = 6, fig.asp = 3.2/4, dev = "svg"}
blue_jays %>%
  ggplot(aes(body_mass_g, head_length_mm)) + 
  geom_point(aes(fill = sex), pch = 21, color = "white", size = 2.5) +
  #geom_smooth(method = "lm", size = 0.75, se = FALSE, color = "black", fullrange = TRUE) +
  scale_x_continuous(name = "body mass (g)", limits = c(58.7, 81.6)) +
  scale_y_continuous(name = "head length (mm)", limits = c(51.5, 60.8)) +
  scale_fill_manual(
    values = c(F = "#D55E00C0", M = "#0072B2C0"),
    breaks = c("F", "M"),
    labels = c("female birds   ", "male birds"),
    name = NULL,
    guide = guide_legend(
      direction = "horizontal",
      override.aes = list(size = 2.5, linetype = 0)
    )
  ) +
  scale_color_manual(
    values = c(F = "#D55E00", M = "#0072B2"),
    breaks = c("F", "M"),
    labels = c("female birds   ", "male birds"),
    name = NULL
  ) +
  theme_minimal_grid() +
  theme(
    legend.position = "top",
    legend.justification = "right",
    legend.box.spacing = unit(3.5, "pt"), # distance between legend and plot
    legend.text = element_text(vjust = 0.6),
    legend.spacing.x = unit(2, "pt"),
    legend.background = element_rect(fill = "white", color = NA),
    legend.key.width = unit(10, "pt")
  )
```
]

???

Figure redrawn after [Claus O. Wilke. Fundamentals of Data Visualization. O'Reilly, 2019.](https://clauswilke.com/dataviz)


---


## Regression lines emphasize the overall trend

.center[
```{r blue-jays-scatter-female, echo = FALSE, message = FALSE, fig.width = 6, fig.asp = 3.2/4, dev = "svg"}
blue_jays %>%
  filter(sex == "F") %>%
  ggplot(aes(body_mass_g, head_length_mm, color = sex, fill = sex)) + 
  geom_point(pch = 21, color = "white", size = 2.5) +
  scale_x_continuous(name = "body mass (g)", limits = c(58.7, 81.6)) +
  scale_y_continuous(name = "head length (mm)", limits = c(51.5, 60.8)) +
  scale_fill_manual(
    values = c(F = "#D55E00C0", M = "#0072B2C0"),
    breaks = c("F", "M"),
    labels = c("female birds   ", "male birds"),
    name = NULL,
    guide = guide_legend(
      direction = "horizontal",
      override.aes = list(size = 2.5, linetype = 0)
    )
  ) +
  scale_color_manual(
    values = c(F = "#D55E00", M = "#0072B2"),
    breaks = c("F", "M"),
    labels = c("female birds   ", "male birds"),
    name = NULL
  ) +
  theme_minimal_grid() +
  theme(
    legend.position = "top",
    legend.justification = "right",
    legend.box.spacing = unit(3.5, "pt"), # distance between legend and plot
    legend.text = element_text(vjust = 0.6),
    legend.spacing.x = unit(2, "pt"),
    legend.background = element_rect(fill = "white", color = NA),
    legend.key.width = unit(10, "pt")
  )
```
]

???

Figure redrawn after [Claus O. Wilke. Fundamentals of Data Visualization. O'Reilly, 2019.](https://clauswilke.com/dataviz)


---

## Regression lines emphasize the overall trend

.center[
```{r blue-jays-scatter-line-female, echo = FALSE, message = FALSE, fig.width = 6, fig.asp = 3.2/4, dev = "svg"}
blue_jays %>%
  filter(sex == "F") %>%
  ggplot(aes(body_mass_g, head_length_mm, color = sex, fill = sex)) + 
  geom_point(pch = 21, color = "white", size = 2.5) +
  geom_smooth(method = "lm", size = 0.75, se = FALSE, fullrange = TRUE) +
  scale_x_continuous(name = "body mass (g)", limits = c(58.7, 81.6)) +
  scale_y_continuous(name = "head length (mm)", limits = c(51.5, 60.8)) +
  scale_fill_manual(
    values = c(F = "#D55E00C0", M = "#0072B2C0"),
    breaks = c("F", "M"),
    labels = c("female birds   ", "male birds"),
    name = NULL,
    guide = guide_legend(
      direction = "horizontal",
      override.aes = list(size = 2.5, linetype = 0)
    )
  ) +
  scale_color_manual(
    values = c(F = "#D55E00", M = "#0072B2"),
    breaks = c("F", "M"),
    labels = c("female birds   ", "male birds"),
    name = NULL
  ) +
  theme_minimal_grid() +
  theme(
    legend.position = "top",
    legend.justification = "right",
    legend.box.spacing = unit(3.5, "pt"), # distance between legend and plot
    legend.text = element_text(vjust = 0.6),
    legend.spacing.x = unit(2, "pt"),
    legend.background = element_rect(fill = "white", color = NA),
    legend.key.width = unit(10, "pt")
  )
```
]

???

Figure redrawn after [Claus O. Wilke. Fundamentals of Data Visualization. O'Reilly, 2019.](https://clauswilke.com/dataviz)


---

## Regression lines emphasize the overall trend

.center[
```{r blue-jays-scatter-male, echo = FALSE, message = FALSE, fig.width = 6, fig.asp = 3.2/4, dev = "svg"}
blue_jays %>%
  filter(sex == "M") %>%
  ggplot(aes(body_mass_g, head_length_mm, color = sex, fill = sex)) + 
  geom_point(pch = 21, color = "white", size = 2.5) +
  scale_x_continuous(name = "body mass (g)", limits = c(58.7, 81.6)) +
  scale_y_continuous(name = "head length (mm)", limits = c(51.5, 60.8)) +
  scale_fill_manual(
    values = c(F = "#D55E00C0", M = "#0072B2C0"),
    breaks = c("F", "M"),
    labels = c("female birds   ", "male birds"),
    name = NULL,
    guide = guide_legend(
      direction = "horizontal",
      override.aes = list(size = 2.5, linetype = 0)
    )
  ) +
  scale_color_manual(
    values = c(F = "#D55E00", M = "#0072B2"),
    breaks = c("F", "M"),
    labels = c("female birds   ", "male birds"),
    name = NULL
  ) +
  theme_minimal_grid() +
  theme(
    legend.position = "top",
    legend.justification = "right",
    legend.box.spacing = unit(3.5, "pt"), # distance between legend and plot
    legend.text = element_text(vjust = 0.6),
    legend.spacing.x = unit(2, "pt"),
    legend.background = element_rect(fill = "white", color = NA),
    legend.key.width = unit(10, "pt")
  )
```
]

???

Figure redrawn after [Claus O. Wilke. Fundamentals of Data Visualization. O'Reilly, 2019.](https://clauswilke.com/dataviz)


---

## Regression lines emphasize the overall trend

.center[
```{r blue-jays-scatter-line-male, echo = FALSE, message = FALSE, fig.width = 6, fig.asp = 3.2/4, dev = "svg"}
blue_jays %>%
  filter(sex == "M") %>%
  ggplot(aes(body_mass_g, head_length_mm, color = sex, fill = sex)) + 
  geom_point(pch = 21, color = "white", size = 2.5) +
  geom_smooth(method = "lm", size = 0.75, se = FALSE, fullrange = TRUE) +
  scale_x_continuous(name = "body mass (g)", limits = c(58.7, 81.6)) +
  scale_y_continuous(name = "head length (mm)", limits = c(51.5, 60.8)) +
  scale_fill_manual(
    values = c(F = "#D55E00C0", M = "#0072B2C0"),
    breaks = c("F", "M"),
    labels = c("female birds   ", "male birds"),
    name = NULL,
    guide = guide_legend(
      direction = "horizontal",
      override.aes = list(size = 2.5, linetype = 0)
    )
  ) +
  scale_color_manual(
    values = c(F = "#D55E00", M = "#0072B2"),
    breaks = c("F", "M"),
    labels = c("female birds   ", "male birds"),
    name = NULL
  ) +
  theme_minimal_grid() +
  theme(
    legend.position = "top",
    legend.justification = "right",
    legend.box.spacing = unit(3.5, "pt"), # distance between legend and plot
    legend.text = element_text(vjust = 0.6),
    legend.spacing.x = unit(2, "pt"),
    legend.background = element_rect(fill = "white", color = NA),
    legend.key.width = unit(10, "pt")
  )
```
]

???

Figure redrawn after [Claus O. Wilke. Fundamentals of Data Visualization. O'Reilly, 2019.](https://clauswilke.com/dataviz)

---

## Regression lines emphasize the overall trend

.center[
```{r blue-jays-scatter-sex-line, echo = FALSE, message = FALSE, fig.width = 6, fig.asp = 3.2/4, dev = "svg"}
blue_jays %>%
  ggplot(aes(body_mass_g, head_length_mm, color = sex, fill = sex)) + 
  geom_point(pch = 21, color = "white", size = 2.5) +
  geom_smooth(method = "lm", size = 0.75, se = FALSE, fullrange = TRUE) +
  scale_x_continuous(name = "body mass (g)", limits = c(58.7, 81.6)) +
  scale_y_continuous(name = "head length (mm)", limits = c(51.5, 60.8)) +
  scale_fill_manual(
    values = c(F = "#D55E00C0", M = "#0072B2C0"),
    breaks = c("F", "M"),
    labels = c("female birds   ", "male birds"),
    name = NULL,
    guide = guide_legend(
      direction = "horizontal",
      override.aes = list(size = 2.5, linetype = 0)
    )
  ) +
  scale_color_manual(
    values = c(F = "#D55E00", M = "#0072B2"),
    breaks = c("F", "M"),
    labels = c("female birds   ", "male birds"),
    name = NULL
  ) +
  theme_minimal_grid() +
  theme(
    legend.position = "top",
    legend.justification = "right",
    legend.box.spacing = unit(3.5, "pt"), # distance between legend and plot
    legend.text = element_text(vjust = 0.6),
    legend.spacing.x = unit(2, "pt"),
    legend.background = element_rect(fill = "white", color = NA),
    legend.key.width = unit(10, "pt")
  )
```
]

???

Figure redrawn after [Claus O. Wilke. Fundamentals of Data Visualization. O'Reilly, 2019.](https://clauswilke.com/dataviz)

---

## Detrending: Removing the underlying trend

.center[
```{r hpi-no-trendline, echo = FALSE, warning = FALSE, fig.width = 6, fig.asp = 0.618, dev = "svg"}

hpi_trends %>%
  filter(state %in% c("California", "Nevada", "West Virginia", "Texas")) %>%
  ggplot(aes(date, hpi)) +
  geom_line(color = "#0072B2", size = 0.75) +
  scale_x_date(name = NULL) +
  scale_y_log10(name = "House Price Index (Dec. 2000 = 100)") +
  facet_wrap(~state, scales = "free_x") +
  theme_minimal_hgrid() +
  theme(
    strip.text = element_text(size = 12),
    strip.background = element_rect(fill = "grey85"),
    axis.line.x = element_line(color = "grey50"),
    axis.ticks.x = element_line(color = "grey50"),
    axis.ticks.y = element_blank(),
    axis.text.y = element_text(margin = margin(0, 0, 0, 0))
  )

```
]

--

.small-font[
Did housing prices in California decline substantially from 1990 to 1998?
]

--

.small-font[
Did housing prices in West Virginia recover by 2017?
]

???

Figure redrawn after [Claus O. Wilke. Fundamentals of Data Visualization. O'Reilly, 2019.](https://clauswilke.com/dataviz)


---

## Detrending: Removing the underlying trend

.center[
```{r hpi-trends, echo = FALSE, warning = FALSE, fig.width = 6, fig.asp = 0.618, dev = "svg"}

hpi_trends %>%
  filter(state %in% c("California", "Nevada", "West Virginia", "Texas")) %>%
  ggplot(aes(date, hpi)) +
  geom_line(aes(y = hpi_trend), color = "grey50", size = 0.4) +
  geom_line(color = "#0072B2", size = 0.75) +
  scale_x_date(name = NULL) +
  scale_y_log10(name = "House Price Index (Dec. 2000 = 100)") +
  facet_wrap(~state, scales = "free_x") +
  theme_minimal_hgrid() +
  theme(
    strip.text = element_text(size = 12),
    strip.background = element_rect(fill = "grey85"),
    axis.line.x = element_line(color = "grey50"),
    axis.ticks.x = element_line(color = "grey50"),
    axis.ticks.y = element_blank(),
    axis.text.y = element_text(margin = margin(0, 0, 0, 0))
  )

```
]

.small-font[
Did housing prices in California decline substantially from 1990 to 1998?
]

.small-font[
Did housing prices in West Virginia recover by 2017?
]

???

Figure redrawn after [Claus O. Wilke. Fundamentals of Data Visualization. O'Reilly, 2019.](https://clauswilke.com/dataviz)


---

## Detrending: Removing the underlying trend

.center[
```{r hpi-detrended, echo = FALSE, warning = FALSE, fig.width = 6, fig.asp = 0.618, dev = "svg"}

hpi_trends %>%
  filter(state %in% c("California", "Nevada", "West Virginia", "Texas")) %>%
  ggplot(aes(date, hpi_detrended)) +
  geom_hline(yintercept = 1, color = "grey50", size = 0.4) +
  geom_line(color = "#0072B2", size = 0.75) +
  scale_x_date(name = NULL) +
  scale_y_log10(
    name = "House Price Index (detrended)",
    breaks = c(0.752, 1, 1.33, 1.77),
    labels = c("0.75", "1.00", "1.33", "1.77")
  ) +
  facet_wrap(~state, scales = "free_x") +
  theme_minimal_hgrid() +
  theme(
    strip.text = element_text(size = 12),
    strip.background = element_rect(fill = "grey85"),
    axis.line.x = element_line(color = "grey50"),
    axis.ticks.x = element_line(color = "grey50"),
    axis.ticks.y = element_blank(),
    axis.text.y = element_text(margin = margin(0, 0, 0, 0))
  )

```
]

.small-font[
Did housing prices in California decline substantially from 1990 to 1998? — yes
]

.small-font[
Did housing prices in West Virginia recover by 2017?  — no
]

???

Figure redrawn after [Claus O. Wilke. Fundamentals of Data Visualization. O'Reilly, 2019.](https://clauswilke.com/dataviz)

---

## Further reading

Relevant chapters from Fundamentals of Data Visualization:
- [Chapter 6: Visualizing amounts](https://clauswilke.com/dataviz/visualizing-amounts.html)
- [Chapter 7: Visualizing distributions: Histograms and density plots](https://clauswilke.com/dataviz/histograms-density-plots.html)
- [Chapter 9: Visualizing many distributions at once](https://clauswilke.com/dataviz/boxplots-violins.html)
- [Chapter 12: Visualizing associations among two or more quantitative variables](https://clauswilke.com/dataviz/visualizing-associations.html)
- [Chapter 14: Visualizing trends](https://clauswilke.com/dataviz/visualizing-trends.html)
